name: Reusable: Publish to Ansible Galaxy

on:
  workflow_call:
    inputs:
      github_user:
        description: "GitHub org/user that owns the repo"
        required: false
        default: "moltimersmith"
        type: string
      github_repo:
        description: "GitHub repo name (not URL)"
        required: true
        type: string
      github_reference:
        description: "Optional git ref to import (tag/branch/sha). If omitted, uses latest tag or main."
        required: false
        type: string
    secrets:
      GALAXY_API_TOKEN:
        required: true

permissions:
  contents: read

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout github-workflows (this repo) to access scripts
        uses: actions/checkout@v6
        with:
          repository: moltimersmith/github-workflows
          # Use main for scripts; callers pin the reusable workflow version separately.
          ref: main
          path: .github-workflows

      - name: Trigger Ansible Galaxy role import
        env:
          GALAXY_API_TOKEN: ${{ secrets.GALAXY_API_TOKEN }}
          GITHUB_USER: ${{ inputs.github_user }}
          GITHUB_REPO: ${{ inputs.github_repo }}
          INPUT_REF: ${{ inputs.github_reference }}
        run: ./.github-workflows/scripts/galaxy-import.sh
